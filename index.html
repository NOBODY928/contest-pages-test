<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>研究生竞赛资讯聚合看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="mb-10 border-b border-gray-200 pb-6">
            <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">竞赛资讯聚合</h1>
            <div class="flex items-center mt-3 text-sm text-gray-500">
                <span class="inline-block w-2 h-2 rounded-full bg-green-500 mr-2 animate-pulse"></span>
                <p id="update-time">正在同步实时数据...</p>
            </div>
        </header>

        <div id="contest-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div class="col-span-full text-center py-20 text-gray-400">正在努力加载竞赛数据...</div>
        </div>

        <footer class="mt-16 text-center text-gray-400 text-xs">
            © 2025 竞赛看板项目 · 数据抓取自各官方公开渠道
        </footer>
    </div>

    <script>
        async function fetchAndRender() {
            try {
                const response = await fetch('./data.json?v=' + Date.now());
                const data = await response.json();
                
                document.getElementById('update-time').innerText = `最后同步时间：${data.generated_at}`;
                const grid = document.getElementById('contest-grid');
                grid.innerHTML = ''; 

                data.items.forEach(item => {
                    // 动态颜色逻辑映射
                    const colorConfig = {
                        'red': 'bg-red-500',
                        'yellow': 'bg-yellow-500',
                        'green': 'bg-green-500',
                        'blue': 'bg-blue-500',
                        'gray': 'bg-gray-400'
                    };

                    // 状态纠偏：如果后端返回的是“已结束”，强制设为红色；“待更新”设为黄色
                    let statusColorClass = colorConfig[item.status.color] || 'bg-gray-400';
                    if (item.status.text.includes('已结束')) statusColorClass = 'bg-red-500';
                    if (item.status.text.includes('待更新')) statusColorClass = 'bg-yellow-500';
                    if (item.status.text.includes('进行') || item.status.text.includes('报名')) statusColorClass = 'bg-green-500';

                    const card = `
                        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
                            <div class="p-6 flex-1">
                                <div class="flex justify-between items-start gap-3 mb-4">
                                    <h2 class="text-base font-bold text-gray-800 leading-snug line-clamp-2">${item.title}</h2>
                                    <span class="${statusColorClass} text-white text-[11px] font-bold px-2.5 py-1 rounded-lg shadow-sm whitespace-nowrap shrink-0">
                                        ${item.status.text}
                                    </span>
                                </div>

                                <div class="flex flex-wrap gap-1.5 mb-5">
                                    ${item.tags.map(tag => `
                                        <span class="bg-blue-50 text-blue-600 text-[10px] px-2 py-0.5 rounded-md font-medium">#${tag}</span>
                                    `).join('')}
                                </div>

                                <div class="space-y-2.5">
                                    ${item.info_grid.map(info => `
                                        <div class="flex flex-col">
                                            <span class="text-[10px] text-gray-400 uppercase tracking-wider">${info.label}</span>
                                            <span class="text-sm text-gray-700 font-semibold truncate">${info.value || '--'}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 rounded-b-2xl flex justify-between items-center">
                                <span class="text-[10px] text-gray-400">更新: ${item.last_updated || '近期'}</span>
                                <a href="${item.link_homepage}" target="_blank" class="text-blue-600 text-xs font-bold hover:text-blue-800 flex items-center transition-colors">
                                    查看官网
                                    <svg class="w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                                </a>
                            </div>
                        </div>
                    `;
                    grid.innerHTML += card;
                });
            } catch (error) {
                console.error("加载失败:", error);
                document.getElementById('contest-grid').innerHTML = '<div class="col-span-full text-red-500 text-center">数据同步失败，请刷新页面或联系管理员。</div>';
            }
        }

        fetchAndRender();
    </script>
</body>
</html>
